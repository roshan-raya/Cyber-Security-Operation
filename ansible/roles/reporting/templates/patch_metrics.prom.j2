# HELP patch_run_duration_seconds Duration of last patch run
# TYPE patch_run_duration_seconds gauge
patch_run_duration_seconds{environment="{{ patch_environment | default('unspecified') }}",group="{{ patch_group | default('all') }}"} {{ ansible_facts['date_time']['epoch'] | int - (patch_start_epoch | default(ansible_facts['date_time']['epoch']) | int) }}

# HELP patch_host_success Patch success per host (1=success, 0=failure)
# TYPE patch_host_success gauge
{% for h in (patch_report_list | default([])) %}
patch_host_success{host="{{ h.host }}",environment="{{ h.environment }}",group="{{ h.group }}"} {{ 0 if h.failed else 1 }}
{% endfor %}

# HELP patch_host_changed Whether host had updates applied
# TYPE patch_host_changed gauge
{% for h in (patch_report_list | default([])) %}
patch_host_changed{host="{{ h.host }}",environment="{{ h.environment }}",group="{{ h.group }}"} {{ 1 if h.changed else 0 }}
{% endfor %}

# HELP patch_last_run_timestamp Unix timestamp of last patch
# TYPE patch_last_run_timestamp gauge
patch_last_run_timestamp{environment="{{ patch_environment | default('unspecified') }}",group="{{ patch_group | default('all') }}"} {{ ansible_facts['date_time']['epoch'] }}

# HELP patch_compliance_percentage Patch compliance (success rate) percentage
# TYPE patch_compliance_percentage gauge
patch_compliance_percentage{environment="{{ patch_environment | default('unspecified') }}",group="{{ patch_group | default('all') }}"} {{ patch_compliance_percentage | default(0) }}
